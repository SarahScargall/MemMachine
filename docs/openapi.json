{
  "openapi": "3.1.0",
  "info": {
    "title": "MemMachine API",
    "version": "2.1.0",
    "description": "Architectural Memory Systems for AI Agents. Specialized in episodic and semantic memory management with strict namespace isolation."
  },
  "servers": [
    {
      "url": "http://localhost:8080"
    }
  ],
  "tags": [
    {
      "name": "Projects",
      "description": "Lifecycle management for isolated memory namespaces."
    },
    {
      "name": "Memories",
      "description": "Core operations for episodic and semantic memory ingestion and retrieval."
    },
    {
      "name": "Semantic Memory",
      "description": "Advanced semantic structure management (Sets, Categories, Tags)."
    },
    {
      "name": "Configuration",
      "description": "Runtime resource management and system configuration."
    },
    {
      "name": "System",
      "description": "Infrastructure, health, and observability."
    }
  ],
  "paths": {
    "/api/v2/projects": {
      "post": {
        "tags": ["Projects"],
        "summary": "Create Project",
        "description": "Initialize a new project namespace. A project is a container for all episodic and semantic memories for a specific agent or application context.",
        "operationId": "create_project",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateProjectSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "description": "Main memory store for the tier-1 support bot",
                "config": {
                  "embedder": "openai-text-3-small",
                  "reranker": "cohere-rerank-english-v3.0"
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": { "description": "Project successfully created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProjectResponse" } } } },
          "422": { "description": "Validation Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RestErrorModel" } } } }
        }
      }
    },
    "/api/v2/projects/delete": {
      "post": {
        "tags": ["Projects"],
        "summary": "Delete Project",
        "description": "Permanently delete a project and all associated memories (episodic and semantic). This action cannot be undone.",
        "operationId": "delete_project",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/DeleteProjectSpec" },
              "example": { "org_id": "acme-corp", "project_id": "customer-support-agent" }
            }
          },
          "required": true
        },
        "responses": {
          "204": { "description": "Project successfully deleted" }
        }
      }
    },
    "/api/v2/memories": {
      "post": {
        "tags": ["Memories"],
        "summary": "Add Memories",
        "description": "Ingest a batch of messages into the episodic memory stream. These messages will be vectorized and stored for future retrieval.",
        "operationId": "add_memories",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AddMemoriesSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "messages": [
                  {
                    "role": "user",
                    "content": "I need help resetting my password.",
                    "timestamp": "2023-10-27T10:00:00Z",
                    "metadata": { "channel": "web_widget" }
                  }
                ]
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": { "description": "Memories successfully added", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddMemoriesResponse" } } } }
        }
      }
    },
    "/api/v2/memories/search": {
      "post": {
        "tags": ["Memories"],
        "summary": "Search Memories",
        "description": "Perform a semantic search across both episodic and semantic memories to retrieve relevant context.",
        "operationId": "search_memories",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/SearchMemoriesSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "query": "How do I reset a password?",
                "top_k": 5,
                "types": ["episodic", "semantic"]
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": { "description": "Search completed successfully", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SearchResult" } } } }
        }
      }
    },
    "/api/v2/memories/episodic/delete": {
      "post": {
        "tags": ["Memories"],
        "summary": "Delete Episodic Memory",
        "description": "Delete specific episodic memory entries by their unique IDs.",
        "operationId": "delete_episodic_memory",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/DeleteEpisodicMemorySpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "episode_ids": ["evt_123456789", "evt_987654321"]
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": { "description": "Episodes successfully deleted" }
        }
      }
    },
    "/api/v2/memories/semantic/delete": {
      "post": {
        "tags": ["Memories"],
        "summary": "Delete Semantic Memory",
        "description": "Delete specific semantic features (facts/concepts) by their unique IDs.",
        "operationId": "delete_semantic_memory",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/DeleteSemanticMemorySpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "feature_ids": ["sem_abc123", "sem_xyz789"]
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": { "description": "Semantic features successfully deleted" }
        }
      }
    },
    "/api/v2/semantic/sets/types": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Create Set Type",
        "description": "Define a new type of Semantic Set (e.g., 'Intent', 'User Preference'). This acts as a high-level container for categories.",
        "operationId": "create_semantic_set_type",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateSemanticSetTypeSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "name": "User Intent",
                "description": "Classifies the user's goal in the conversation"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": { "description": "Set Type created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CreateSemanticSetTypeResponse" } } } }
        }
      }
    },
    "/api/v2/semantic/sets/types/delete": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Delete Set Type",
        "description": "Delete a Semantic Set Type and all its associated configuration.",
        "operationId": "delete_semantic_set_type",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/DeleteSemanticSetTypeSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "set_type_id": "set_type_123"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": { "description": "Set Type deleted" }
        }
      }
    },
    "/api/v2/semantic/sets/configure": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Configure Set",
        "description": "Enable or disable a specific Semantic Set Type for a project.",
        "operationId": "configure_semantic_set",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ConfigureSemanticSetSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "set_type_id": "set_type_123",
                "enabled": true
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": { "description": "Configuration updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SemanticSetEntry" } } } }
        }
      }
    },
    "/api/v2/semantic/categories": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Add Category",
        "description": "Add a specific category to a Semantic Set (e.g., adding 'Refund Request' to the 'User Intent' set).",
        "operationId": "add_semantic_category",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AddSemanticCategorySpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "set_id": "set_123",
                "name": "Refund Request",
                "description": "User wants money back",
                "template_id": "tpl_standard_intent"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": { "description": "Category created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddSemanticCategoryResponse" } } } }
        }
      }
    },
    "/api/v2/semantic/categories/delete": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Delete Category",
        "description": "Remove a semantic category.",
        "operationId": "delete_semantic_category",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/DeleteSemanticCategorySpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "category_id": "cat_456"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": { "description": "Category deleted" }
        }
      }
    },
    "/api/v2/semantic/tags": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Add Tag",
        "description": "Add a tag value to a semantic category.",
        "operationId": "add_semantic_tag",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AddSemanticTagSpec" },
              "example": {
                 "org_id": "acme-corp",
                 "project_id": "customer-support-agent",
                 "category_id": "cat_456",
                 "value": "urgent"
              }
            }
          },
          "required": true
        },
        "responses": {
           "201": { "description": "Tag created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddSemanticTagResponse" } } } }
        }
      }
    },
    "/api/v2/semantic/tags/delete": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Delete Tag",
        "description": "Remove a tag from a semantic category.",
        "operationId": "delete_semantic_tag",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/DeleteSemanticTagSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "tag_id": "tag_789"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": { "description": "Tag deleted" }
        }
      }
    },
    "/api/v2/features": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Add Feature",
        "description": "Manually inject a semantic feature (fact/concept) into the system.",
        "operationId": "add_feature",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AddFeatureSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "customer-support-agent",
                "category_id": "cat_456",
                "value": "User is frustrated",
                "metadata": { "source": "manual_entry", "confidence": 1.0 }
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": { "description": "Feature created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddFeatureResponse" } } } }
        }
      }
    },
    "/api/v2/config/memory": {
      "put": {
        "tags": ["Configuration"],
        "summary": "Update Memory Config",
        "description": "Update global configuration for episodic or semantic memory.",
        "operationId": "update_memory_config",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/UpdateMemoryConfigSpec" },
              "example": {
                "episodic_memory": {
                  "enabled": true,
                  "long_term_memory_enabled": true,
                  "long_term_memory": {
                    "embedder": "openai-small",
                    "vector_graph_store": "neo4j-prod"
                  }
                },
                "semantic_memory": {
                  "enabled": true,
                  "ingestion_trigger_messages": 10
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": { "description": "Configuration updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateMemoryConfigResponse" } } } }
        }
      }
    },
    "/api/v2/config/resources/embedders": {
      "post": {
        "tags": ["Configuration"],
        "summary": "Add Embedder",
        "description": "Register a new embedding model provider.",
        "operationId": "add_embedder",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AddEmbedderSpec" },
              "example": {
                "name": "openai-3-large",
                "provider": "openai",
                "config": {
                  "model": "text-embedding-3-large",
                  "api_key": "sk-..."
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": { "description": "Embedder registered", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateResourceResponse" } } } }
        }
      }
    },
    "/api/v2/metrics": {
      "get": {
        "tags": ["System"],
        "summary": "Metrics",
        "description": "Expose Prometheus metrics endpoint.",
        "operationId": "metrics",
        "responses": {
          "200": { "description": "Success", "content": { "text/plain": { "schema": { "type": "string" } } } }
        }
      }
    },
    "/api/v2/health": {
      "get": {
        "tags": ["System"],
        "summary": "Health Check",
        "description": "Check the running status of the MemMachine service.",
        "operationId": "health_check",
        "responses": { "200": { "description": "System is healthy" } }
      }
    }
  },
  "components": {
    "schemas": {
      "DeleteProjectSpec": {
        "type": "object",
        "required": ["org_id", "project_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" }
        }
      },
      "DeleteEpisodicMemorySpec": {
        "type": "object",
        "required": ["org_id", "project_id", "episode_ids"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "episode_ids": { "type": "array", "items": { "type": "string" } }
        }
      },
      "DeleteSemanticMemorySpec": {
        "type": "object",
        "required": ["org_id", "project_id", "feature_ids"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "feature_ids": { "type": "array", "items": { "type": "string" } }
        }
      },
      "CreateSemanticSetTypeSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "name"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "name": { "type": "string", "description": "The display name for this semantic set type." },
          "description": { "type": "string", "description": "A description of what this set represents." }
        }
      },
      "CreateSemanticSetTypeResponse": {
        "type": "object",
        "required": ["id"],
        "properties": { "id": { "type": "string" } }
      },
      "DeleteSemanticSetTypeSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "set_type_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "set_type_id": { "type": "string" }
        }
      },
      "ConfigureSemanticSetSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "set_type_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "set_type_id": { "type": "string" },
          "enabled": { "type": "boolean" }
        }
      },
      "SemanticSetEntry": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "type_id": { "type": "string" },
          "enabled": { "type": "boolean" }
        }
      },
      "AddSemanticCategorySpec": {
        "type": "object",
        "required": ["org_id", "project_id", "set_id", "name"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "set_id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "template_id": { "type": "string" }
        }
      },
      "AddSemanticCategoryResponse": {
        "type": "object",
        "required": ["id"],
        "properties": { "id": { "type": "string" } }
      },
      "DeleteSemanticCategorySpec": {
        "type": "object",
        "required": ["org_id", "project_id", "category_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "category_id": { "type": "string" }
        }
      },
      "AddSemanticTagSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "category_id", "value"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "category_id": { "type": "string" },
          "value": { "type": "string" }
        }
      },
      "AddSemanticTagResponse": {
        "type": "object",
        "required": ["id"],
        "properties": { "id": { "type": "string" } }
      },
      "DeleteSemanticTagSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "tag_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "tag_id": { "type": "string" }
        }
      },
      "AddFeatureSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "category_id", "value"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "category_id": { "type": "string" },
          "value": { "type": "string" },
          "metadata": { "type": "object" }
        }
      },
      "AddFeatureResponse": {
        "type": "object",
        "required": ["id"],
        "properties": { "id": { "type": "string" } }
      },
      "UpdateMemoryConfigSpec": {
        "type": "object",
        "properties": {
          "episodic_memory": { "$ref": "#/components/schemas/UpdateEpisodicMemorySpec" },
          "semantic_memory": { "$ref": "#/components/schemas/UpdateSemanticMemorySpec" }
        }
      },
      "UpdateSemanticMemorySpec": {
        "type": "object",
        "properties": {
          "enabled": { "type": "boolean" },
          "database": { "type": "string" },
          "llm_model": { "type": "string" },
          "embedding_model": { "type": "string" },
          "ingestion_trigger_messages": { "type": "integer" },
          "ingestion_trigger_age_seconds": { "type": "integer" }
        }
      },
      "UpdateEpisodicMemorySpec": {
        "type": "object",
        "properties": {
          "enabled": { "type": "boolean" },
          "long_term_memory_enabled": { "type": "boolean" },
          "short_term_memory_enabled": { "type": "boolean" },
          "long_term_memory": {
            "type": "object",
            "properties": {
              "embedder": { "type": "string" },
              "reranker": { "type": "string" },
              "vector_graph_store": { "type": "string" }
            }
          },
          "short_term_memory": {
            "type": "object",
            "properties": {
              "llm_model": { "type": "string" },
              "message_capacity": { "type": "integer" }
            }
          }
        }
      },
      "UpdateMemoryConfigResponse": {
        "type": "object",
        "required": ["success", "message"],
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" }
        }
      },
      "AddEmbedderSpec": {
        "type": "object",
        "required": ["name", "provider", "config"],
        "properties": {
          "name": { "type": "string" },
          "provider": { "type": "string", "enum": ["openai", "amazon-bedrock", "sentence-transformer"] },
          "config": { "type": "object", "additionalProperties": true }
        }
      },
      "UpdateResourceResponse": {
        "type": "object",
        "required": ["success", "status"],
        "properties": {
          "success": { "type": "boolean" },
          "status": { "type": "string", "enum": ["READY", "FAILED", "INITIALIZING"] },
          "error": { "type": "string", "nullable": true }
        }
      },
      "CreateProjectSpec": {
        "type": "object",
        "required": ["org_id", "project_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "description": { "type": "string" },
          "config": { "$ref": "#/components/schemas/ProjectConfig" }
        }
      },
      "ProjectConfig": {
        "type": "object",
        "properties": {
          "embedder": { "type": "string" },
          "reranker": { "type": "string" }
        }
      },
      "ProjectResponse": {
        "type": "object",
        "required": ["org_id", "project_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "description": { "type": "string" },
          "config": { "$ref": "#/components/schemas/ProjectConfig" }
        }
      },
      "AddMemoriesSpec": {
        "type": "object",
        "required": ["messages"],
        "properties": {
          "org_id": { "type": "string", "default": "universal" },
          "project_id": { "type": "string", "default": "universal" },
          "messages": { "type": "array", "items": { "$ref": "#/components/schemas/MemoryMessage" } }
        }
      },
      "MemoryMessage": {
        "type": "object",
        "required": ["content"],
        "properties": {
          "content": { "type": "string" },
          "role": { "type": "string" },
          "timestamp": { "type": "string" },
          "metadata": { "type": "object" }
        }
      },
      "AddMemoriesResponse": {
        "type": "object",
        "properties": { "results": { "type": "array", "items": { "type": "object" } } }
      },
      "SearchMemoriesSpec": {
        "type": "object",
        "required": ["query"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "query": { "type": "string" },
          "top_k": { "type": "integer" },
          "types": { "type": "array", "items": { "type": "string" } }
        }
      },
      "SearchResult": {
        "type": "object",
        "required": ["status", "content"],
        "properties": {
          "status": { "type": "integer" },
          "content": { "type": "object", "additionalProperties": true }
        }
      },
      "RestErrorModel": {
        "type": "object",
        "required": ["code", "message"],
        "properties": {
          "code": { "type": "integer" },
          "message": { "type": "string" },
          "trace": { "type": "string" }
        }
      }
    }
  }
}
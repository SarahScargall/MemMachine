{
  "openapi": "3.1.0",
  "info": {
    "title": "MemMachine API",
    "version": "2.2.0",
    "description": "Architectural Memory Systems for AI Agents. Specialized in episodic and semantic memory management with strict namespace isolation."
  },
  "servers": [
    {
      "url": "http://localhost:8080/api/v2"
    }
  ],
  "tags": [
    {
      "name": "Projects",
      "description": "Lifecycle management for isolated memory namespaces."
    },
    {
      "name": "Memories",
      "description": "Core operations for episodic and semantic memory ingestion and retrieval."
    },
    {
      "name": "Semantic Memory",
      "description": "Advanced management of semantic sets, categories, templates, and tags."
    },
    {
      "name": "Configuration",
      "description": "Granular runtime resource management and memory settings."
    },
    {
      "name": "System",
      "description": "Infrastructure, health, and observability."
    }
  ],
  "paths": {
    "/projects": {
      "post": {
        "tags": ["Projects"],
        "summary": "Create Project",
        "operationId": "create_project",
        "description": "Initialize a new project namespace. A project is a container for all episodic and semantic memories for a specific agent or application context.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateProjectSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "agent-smith-v1",
                "description": "Primary memory store for customer support agent",
                "config": {
                  "embedder": "openai-text-3-small",
                  "reranker": "cohere-rerank-english-v3.0"
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": { "description": "Project successfully created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProjectResponse" } } } },
          "422": { "description": "Validation Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RestErrorModel" } } } }
        }
      }
    },
    "/projects/delete": {
      "post": {
        "tags": ["Projects"],
        "summary": "Delete Project",
        "operationId": "delete_project",
        "description": "Permanently delete a project and all associated memories (episodic and semantic). This action cannot be undone.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/DeleteProjectSpec" },
              "example": { "org_id": "acme-corp", "project_id": "agent-smith-v1" }
            }
          },
          "required": true
        },
        "responses": {
          "204": { "description": "Project successfully deleted" }
        }
      }
    },
    "/memories": {
      "post": {
        "tags": ["Memories"],
        "summary": "Add Memories",
        "operationId": "add_memories",
        "description": "Ingest a batch of messages into the episodic memory stream. These messages will be vectorized and stored for future retrieval.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AddMemoriesSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "agent-smith-v1",
                "messages": [
                  {
                    "role": "user",
                    "content": "I need help resetting my password.",
                    "timestamp": "2023-10-27T10:00:00Z",
                    "metadata": { "channel": "web_widget" }
                  }
                ]
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": { "description": "Memories successfully added", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddMemoriesResponse" } } } }
        }
      }
    },
    "/memories/search": {
      "post": {
        "tags": ["Memories"],
        "summary": "Search Memories",
        "operationId": "search_memories",
        "description": "Perform a semantic search across both episodic and semantic memories to retrieve relevant context.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/SearchMemoriesSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "agent-smith-v1",
                "query": "How do I reset a password?",
                "top_k": 5,
                "types": ["episodic", "semantic"]
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": { "description": "Search completed successfully", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SearchResult" } } } }
        }
      }
    },
    "/memories/list": {
      "post": {
        "tags": ["Memories"],
        "summary": "List Memories",
        "operationId": "list_memories",
        "description": "Retrieve a paginated list of memories based on filters.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ListMemoriesSpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Success", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ListResult" } } } }
        }
      }
    },
    "/memories/episodic/delete": {
      "post": {
        "tags": ["Memories"],
        "summary": "Delete Episodic Memory",
        "operationId": "delete_episodic_memory",
        "description": "Delete specific episodic memory entries by their unique IDs.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteEpisodicMemorySpec" } } },
          "required": true
        },
        "responses": {
          "204": { "description": "Episodes successfully deleted" }
        }
      }
    },
    "/memories/semantic/delete": {
      "post": {
        "tags": ["Memories"],
        "summary": "Delete Semantic Memory",
        "operationId": "delete_semantic_memory",
        "description": "Delete specific semantic features (facts/concepts) by their unique IDs.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteSemanticMemorySpec" } } },
          "required": true
        },
        "responses": {
          "204": { "description": "Semantic features successfully deleted" }
        }
      }
    },
    "/semantic/sets/types": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Create Set Type",
        "operationId": "create_semantic_set_type",
        "description": "Define a new type of Semantic Set (e.g., 'Intent', 'User Preference').",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CreateSemanticSetTypeSpec" } } },
          "required": true
        },
        "responses": {
          "201": { "description": "Set Type created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/GenericIdResponse" } } } }
        }
      }
    },
    "/semantic/sets/types/delete": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Delete Set Type",
        "operationId": "delete_semantic_set_type",
        "description": "Delete a Semantic Set Type and all its associated configuration.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteSemanticSetTypeSpec" } } },
          "required": true
        },
        "responses": {
          "204": { "description": "Set Type deleted" }
        }
      }
    },
    "/semantic/sets/configure": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Configure Set",
        "operationId": "configure_semantic_set",
        "description": "Enable or disable a specific Semantic Set Type for a project.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ConfigureSemanticSetSpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Configuration updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SemanticSetEntry" } } } }
        }
      }
    },
    "/semantic/categories": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Add Category",
        "operationId": "add_semantic_category",
        "description": "Add a specific category to a Semantic Set.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddSemanticCategorySpec" } } },
          "required": true
        },
        "responses": {
          "201": { "description": "Category created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/GenericIdResponse" } } } }
        }
      }
    },
    "/semantic/categories/delete": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Delete Category",
        "operationId": "delete_semantic_category",
        "description": "Remove a semantic category.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteSemanticCategorySpec" } } },
          "required": true
        },
        "responses": {
          "204": { "description": "Category deleted" }
        }
      }
    },
    "/semantic/categories/templates/list": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "List Templates",
        "operationId": "list_semantic_category_templates",
        "description": "Retrieve available templates for semantic categories.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ListSemanticCategoryTemplatesSpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Success", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ListSemanticCategoryTemplatesResponse" } } } }
        }
      }
    },
    "/semantic/tags": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Add Tag",
        "operationId": "add_semantic_tag",
        "description": "Add a tag value to a semantic category.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddSemanticTagSpec" } } },
          "required": true
        },
        "responses": {
           "201": { "description": "Tag created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/GenericIdResponse" } } } }
        }
      }
    },
    "/semantic/tags/delete": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Delete Tag",
        "operationId": "delete_semantic_tag",
        "description": "Remove a tag from a semantic category.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteSemanticTagSpec" } } },
          "required": true
        },
        "responses": {
          "204": { "description": "Tag deleted" }
        }
      }
    },
    "/features": {
      "post": {
        "tags": ["Semantic Memory"],
        "summary": "Add Feature",
        "operationId": "add_feature",
        "description": "Manually inject a semantic feature (fact/concept) into the system.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddFeatureSpec" } } },
          "required": true
        },
        "responses": {
          "201": { "description": "Feature created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/GenericIdResponse" } } } }
        }
      }
    },
    "/config/memory/episodic": {
      "put": {
        "tags": ["Configuration"],
        "summary": "Update Episodic Config",
        "operationId": "update_episodic_config",
        "description": "Configure settings specific to the Episodic Memory pipeline (e.g., enabling/disabling).",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateEpisodicMemorySpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Configuration Updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateMemoryConfigResponse" } } } }
        }
      }
    },
    "/config/memory/semantic": {
      "put": {
        "tags": ["Configuration"],
        "summary": "Update Semantic Config",
        "operationId": "update_semantic_config",
        "description": "Configure settings specific to the Semantic Memory pipeline (e.g., ingestion triggers).",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateSemanticMemorySpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Configuration Updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateMemoryConfigResponse" } } } }
        }
      }
    },
    "/config/memory/long-term": {
      "put": {
        "tags": ["Configuration"],
        "summary": "Update Long-Term Config",
        "operationId": "update_long_term_config",
        "description": "Configure the underlying vector store and embedding parameters for Long-Term Memory.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateLongTermMemorySpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Configuration Updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateMemoryConfigResponse" } } } }
        }
      }
    },
    "/config/memory/short-term": {
      "put": {
        "tags": ["Configuration"],
        "summary": "Update Short-Term Config",
        "operationId": "update_short_term_config",
        "description": "Configure the working memory buffer capacity and parameters.",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateShortTermMemorySpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Configuration Updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateMemoryConfigResponse" } } } }
        }
      }
    },
    "/config/resources/embedders": {
      "post": {
        "tags": ["Configuration"],
        "summary": "Add Embedder",
        "operationId": "add_embedder",
        "description": "Register a new embedding model provider.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AddEmbedderSpec" },
              "example": {
                "name": "openai-3-large",
                "provider": "openai",
                "config": { "model": "text-embedding-3-large", "api_key": "sk-..." }
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": { "description": "Embedder registered", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateResourceResponse" } } } }
        }
      }
    },
    "/config/resources/rerankers/{name}/retry": {
      "post": {
        "tags": ["Configuration"],
        "summary": "Retry Reranker",
        "operationId": "retry_reranker",
        "description": "Attempt to re-initialize a failed reranker resource.",
        "parameters": [{ "name": "name", "in": "path", "required": true, "schema": { "type": "string" } }],
        "responses": {
          "200": { "description": "Retry attempt completed", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateResourceResponse" } } } }
        }
      }
    },
    "/metrics": {
      "get": {
        "tags": ["System"],
        "summary": "Metrics",
        "description": "Expose Prometheus metrics endpoint.",
        "operationId": "metrics",
        "responses": {
          "200": { "description": "Success", "content": { "text/plain": { "schema": { "type": "string" } } } }
        }
      }
    },
    "/health": {
      "get": {
        "tags": ["System"],
        "summary": "Health Check",
        "description": "Check the running status of the MemMachine service.",
        "operationId": "health_check",
        "responses": { "200": { "description": "System is healthy" } }
      }
    }
  },
  "components": {
    "schemas": {
      "GenericIdResponse": {
        "type": "object",
        "properties": { "id": { "type": "string", "description": "The unique identifier of the created resource." } }
      },
      "CreateProjectSpec": {
        "type": "object",
        "required": ["org_id", "project_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "description": { "type": "string" },
          "config": { "$ref": "#/components/schemas/ProjectConfig" }
        }
      },
      "ProjectConfig": {
        "type": "object",
        "properties": {
          "embedder": { "type": "string" },
          "reranker": { "type": "string" }
        }
      },
      "ProjectResponse": {
        "type": "object",
        "required": ["org_id", "project_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "description": { "type": "string" },
          "config": { "$ref": "#/components/schemas/ProjectConfig" }
        }
      },
      "DeleteProjectSpec": {
        "type": "object",
        "required": ["org_id", "project_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" }
        }
      },
      "DeleteEpisodicMemorySpec": {
        "type": "object",
        "required": ["org_id", "project_id", "episode_ids"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "episode_ids": { "type": "array", "items": { "type": "string" } }
        }
      },
      "DeleteSemanticMemorySpec": {
        "type": "object",
        "required": ["org_id", "project_id", "feature_ids"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "feature_ids": { "type": "array", "items": { "type": "string" } }
        }
      },
      "CreateSemanticSetTypeSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "name"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "name": { "type": "string", "description": "The display name for this semantic set type." },
          "description": { "type": "string", "description": "A description of what this set represents." }
        }
      },
      "DeleteSemanticSetTypeSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "set_type_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "set_type_id": { "type": "string" }
        }
      },
      "ConfigureSemanticSetSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "set_type_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "set_type_id": { "type": "string" },
          "enabled": { "type": "boolean" }
        }
      },
      "SemanticSetEntry": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "type_id": { "type": "string" },
          "enabled": { "type": "boolean" }
        }
      },
      "AddSemanticCategorySpec": {
        "type": "object",
        "required": ["org_id", "project_id", "set_id", "name"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "set_id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "template_id": { "type": "string" }
        }
      },
      "DeleteSemanticCategorySpec": {
        "type": "object",
        "required": ["org_id", "project_id", "category_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "category_id": { "type": "string" }
        }
      },
      "ListSemanticCategoryTemplatesSpec": {
        "type": "object",
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" }
        }
      },
      "ListSemanticCategoryTemplatesResponse": {
        "type": "object",
        "properties": {
          "items": { "type": "array", "items": { "type": "object" } }
        }
      },
      "AddSemanticTagSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "category_id", "value"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "category_id": { "type": "string" },
          "value": { "type": "string" }
        }
      },
      "DeleteSemanticTagSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "tag_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "tag_id": { "type": "string" }
        }
      },
      "AddFeatureSpec": {
        "type": "object",
        "required": ["org_id", "project_id", "category_id", "value"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "category_id": { "type": "string" },
          "value": { "type": "string" },
          "metadata": { "type": "object" }
        }
      },
      "AddMemoriesSpec": {
        "type": "object",
        "required": ["messages"],
        "properties": {
          "org_id": { "type": "string", "default": "universal" },
          "project_id": { "type": "string", "default": "universal" },
          "messages": { "type": "array", "items": { "$ref": "#/components/schemas/MemoryMessage" } }
        }
      },
      "MemoryMessage": {
        "type": "object",
        "required": ["content"],
        "properties": {
          "content": { "type": "string" },
          "role": { "type": "string", "default": "user" },
          "timestamp": { "type": "string" },
          "metadata": { "type": "object" }
        }
      },
      "AddMemoriesResponse": {
        "type": "object",
        "properties": { "results": { "type": "array", "items": { "type": "object" } } }
      },
      "SearchMemoriesSpec": {
        "type": "object",
        "required": ["query"],
        "properties": {
          "org_id": { "type": "string", "default": "universal" },
          "project_id": { "type": "string", "default": "universal" },
          "query": { "type": "string" },
          "top_k": { "type": "integer", "default": 10 },
          "types": { "type": "array", "items": { "type": "string" } }
        }
      },
      "SearchResult": {
        "type": "object",
        "required": ["status", "content"],
        "properties": {
          "status": { "type": "integer" },
          "content": { "type": "object", "additionalProperties": true }
        }
      },
      "ListMemoriesSpec": {
        "type": "object",
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "page_size": { "type": "integer", "default": 20 },
          "page_num": { "type": "integer", "default": 0 },
          "filter": { "type": "string" }
        }
      },
      "ListResult": {
        "type": "object",
        "required": ["items", "total"],
        "properties": {
          "items": { "type": "array", "items": { "type": "object" } },
          "total": { "type": "integer" }
        }
      },
      "UpdateEpisodicMemorySpec": {
        "type": "object",
        "properties": {
          "enabled": { "type": "boolean" },
          "long_term_memory_enabled": { "type": "boolean" },
          "short_term_memory_enabled": { "type": "boolean" }
        }
      },
      "UpdateSemanticMemorySpec": {
        "type": "object",
        "properties": {
          "enabled": { "type": "boolean" },
          "database": { "type": "string" },
          "llm_model": { "type": "string" },
          "ingestion_trigger_messages": { "type": "integer" }
        }
      },
      "UpdateLongTermMemorySpec": {
        "type": "object",
        "properties": {
          "vector_store": { "type": "string" },
          "embedder": { "type": "string" },
          "reranker": { "type": "string" }
        }
      },
      "UpdateShortTermMemorySpec": {
        "type": "object",
        "properties": {
          "capacity": { "type": "integer" },
          "buffer_size": { "type": "integer" }
        }
      },
      "UpdateMemoryConfigResponse": {
        "type": "object",
        "required": ["success", "message"],
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" }
        }
      },
      "AddEmbedderSpec": {
        "type": "object",
        "required": ["name", "provider", "config"],
        "properties": {
          "name": { "type": "string" },
          "provider": { "type": "string", "enum": ["openai", "amazon-bedrock", "sentence-transformer"] },
          "config": {
            "type": "object",
            "properties": {
              "model": { "type": "string" },
              "api_key": { "type": "string", "format": "password" },
              "aws_region": { "type": "string" }
            },
            "additionalProperties": true
          }
        }
      },
      "UpdateResourceResponse": {
        "type": "object",
        "required": ["success", "status"],
        "properties": {
          "success": { "type": "boolean" },
          "status": { "type": "string", "enum": ["READY", "FAILED", "INITIALIZING"] },
          "error": { "type": "string", "nullable": true }
        }
      },
      "RestErrorModel": {
        "type": "object",
        "required": ["code", "message"],
        "properties": {
          "code": { "type": "integer" },
          "message": { "type": "string" },
          "trace": { "type": "string" }
        }
      }
    }
  }
}